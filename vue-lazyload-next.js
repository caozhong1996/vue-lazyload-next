!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).vueLazyloadNext=t(e.Vue)}(this,(function(e){"use strict";function t(e,t){return e(t={exports:{}},t.exports),t.exports}var n=t((function(e){var t=Object.prototype.toString,n=Object.prototype.propertyIsEnumerable,r=Object.getOwnPropertySymbols;function i(e){return"function"==typeof e||"[object Object]"===t.call(e)||Array.isArray(e)}e.exports=function(e){for(var t=arguments.length,o=Array(t>1?t-1:0),a=1;a<t;a++)o[a-1]=arguments[a];if(!i(e))throw new TypeError("expected the first argument to be an object");if(0===o.length||"function"!=typeof Symbol||"function"!=typeof r)return e;var s=!0,u=!1,l=void 0;try{for(var d,c=o[Symbol.iterator]();!(s=(d=c.next()).done);s=!0){var h=d.value,f=r(h),v=!0,p=!1,A=void 0;try{for(var g,y=f[Symbol.iterator]();!(v=(g=y.next()).done);v=!0){var m=g.value;n.call(h,m)&&(e[m]=h[m])}}catch(e){p=!0,A=e}finally{try{!v&&y.return&&y.return()}finally{if(p)throw A}}}}catch(e){u=!0,l=e}finally{try{!s&&c.return&&c.return()}finally{if(u)throw l}}return e}})),r=Object.freeze({__proto__:null,default:n,__moduleExports:n}),i=r&&n||r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=t((function(e){var t=Object.prototype.toString,n=function(e){return"__proto__"!==e&&"constructor"!==e&&"prototype"!==e},r=e.exports=function(e){for(var t=arguments.length,o=Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];var l=0;for(s(e)&&(e=o[l++]),e||(e={});l<o.length;l++)if(a(o[l])){var d=!0,c=!1,h=void 0;try{for(var f,v=Object.keys(o[l])[Symbol.iterator]();!(d=(f=v.next()).done);d=!0){var p=f.value;n(p)&&(a(e[p])&&a(o[l][p])?r(e[p],o[l][p]):e[p]=o[l][p])}}catch(e){c=!0,h=e}finally{try{!d&&v.return&&v.return()}finally{if(c)throw h}}i(e,o[l])}return e};function a(e){return"function"==typeof e||"[object Object]"===t.call(e)}function s(e){return"object"===(void 0===e?"undefined":o(e))?null===e:"function"!=typeof e}})),l="undefined"!=typeof window&&null!==window,d=function(){if(l&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)return"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}}),!0;return!1}();var c="event",h="observer";function f(e,t){if(e.length){var n=e.indexOf(t);return n>-1?e.splice(n,1):void 0}}function v(e,t){if("IMG"!==e.tagName||!e.getAttribute("data-srcset"))return"";var n=e.getAttribute("data-srcset").trim().split(","),r=[],i=e.parentNode.offsetWidth*t,o=void 0,a=void 0,s=void 0;n.forEach((function(e){e=e.trim(),-1===(o=e.lastIndexOf(" "))?(a=e,s=99999):(a=e.substr(0,o),s=parseInt(e.substr(o+1,e.length-o-2),10)),r.push([s,a])})),r.sort((function(e,t){if(e[0]<t[0])return 1;if(e[0]>t[0])return-1;if(e[0]===t[0]){if(-1!==t[1].indexOf(".webp",t[1].length-5))return 1;if(-1!==e[1].indexOf(".webp",e[1].length-5))return-1}return 0}));for(var u="",l=void 0,d=0;d<r.length;d++){u=(l=r[d])[1];var c=r[d+1];if(c&&c[0]<i){u=l[1];break}if(!c){u=l[1];break}}return u}var p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return l&&window.devicePixelRatio||e};function A(){if(!l)return!1;var e=!0;function t(e,t){var n=new Image;n.onload=function(){var e=n.width>0&&n.height>0;t(e)},n.onerror=function(){t(!1)},n.src="data:image/webp;base64,"+{lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"}[e]}return t("lossy",(function(t){e=t})),t("lossless",(function(t){e=t})),t("alpha",(function(t){e=t})),t("animation",(function(t){e=t})),e}var g=function(){if(!l)return!1;var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",_,t)}catch(e){}return e}(),y={on:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];g?e.addEventListener(t,n,{capture:r,passive:!0}):e.addEventListener(t,n,r)},off:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.removeEventListener(t,n,r)}},m=function(e,t,n){var r=new Image;if(!e||!e.src){var i=new Error("image src is required");return n(i)}e.cors&&(r.crossOrigin=e.cors),r.src=e.src,r.onload=function(){t({naturalHeight:r.naturalHeight,naturalWidth:r.naturalWidth,src:r.src}),r=null},r.onerror=function(e){n(e)}},b=function(e,t){return"undefined"!=typeof getComputedStyle?getComputedStyle(e,null).getPropertyValue(t):e.style[t]},w=function(e){return b(e,"overflow")+b(e,"overflowY")+b(e,"overflowX")};function _(){}var L=function(){function e(t){a(this,e),this.max=t||100,this._caches=[]}return s(e,[{key:"has",value:function(e){return this._caches.indexOf(e)>-1}},{key:"add",value:function(e){this.has(e)||(this._caches.push(e),this._caches.length>this.max&&this.free())}},{key:"free",value:function(){this._caches.shift()}}]),e}(),E=function(){function e(t,n,r,i,o,s,u,l,d,c){a(this,e),this.el=t,this.src=n,this.error=r,this.loading=i,this.bindType=o,this.attempt=0,this.cors=l,this.naturalHeight=0,this.naturalWidth=0,this.options=u,this.rect={},this.$parent=s,this.elRenderer=d,this._imageCache=c,this.performanceData={init:Date.now(),loadStart:0,loadEnd:0},this.filter(),this.initState(),this.render("loading",!1)}return s(e,[{key:"initState",value:function(){"dataset"in this.el?this.el.dataset.src=this.src:this.el.setAttribute("data-src",this.src),this.state={loading:!1,error:!1,loaded:!1,rendered:!1}}},{key:"record",value:function(e){this.performanceData[e]=Date.now()}},{key:"update",value:function(e){var t=this.src;this.src=e.src,this.loading=e.loading,this.error=e.error,this.filter(),t!==this.src&&(this.attempt=0,this.initState())}},{key:"getRect",value:function(){this.rect=this.el.getBoundingClientRect()}},{key:"checkInView",value:function(){return this.getRect(),this.rect.top<window.innerHeight*this.options.preLoad&&this.rect.bottom>this.options.preLoadTop&&this.rect.left<window.innerWidth*this.options.preLoad&&this.rect.right>0}},{key:"filter",value:function(){for(var e in this.options.filter)this.options.filter[e](this,this.options)}},{key:"renderLoading",value:function(e){var t=this;this.state.loading=!0,m({src:this.loading,cors:this.cors},(function(){t.render("loading",!1),t.state.loading=!1,e()}),(function(){e(),t.state.loading=!1,t.options.silent||console.warn("VueLazyload log: load failed with loading image("+t.loading+")")}))}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_;return this.attempt>this.options.attempt-1&&this.state.error?(this.options.silent||console.log("VueLazyload log: "+this.src+" tried too more than "+this.options.attempt+" times"),void t()):this.state.rendered&&this.state.loaded?void 0:this._imageCache.has(this.src)?(this.state.loaded=!0,this.render("loaded",!0),this.state.rendered=!0,t()):void this.renderLoading((function(){e.attempt++,e.options.adapter.beforeLoad&&e.options.adapter.beforeLoad(e,e.options),e.record("loadStart"),m({src:e.src,cors:e.cors},(function(n){e.naturalHeight=n.naturalHeight,e.naturalWidth=n.naturalWidth,e.state.loaded=!0,e.state.error=!1,e.record("loadEnd"),e.render("loaded",!1),e.state.rendered=!0,e._imageCache.add(e.src),t()}),(function(t){!e.options.silent&&console.error(t),e.state.error=!0,e.state.loaded=!1,e.render("error",!1)}))}))}},{key:"render",value:function(e,t){this.elRenderer(this,e,t)}},{key:"performance",value:function(){var e="loading",t=0;return this.state.loaded&&(e="loaded",t=(this.performanceData.loadEnd-this.performanceData.loadStart)/1e3),this.state.error&&(e="error"),{src:this.src,state:e,time:t}}},{key:"$destroy",value:function(){this.el=null,this.src="",this.error=null,this.loading="",this.bindType=null,this.attempt=0}}]),e}(),k="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Q=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],I={rootMargin:"0px",threshold:0},T=function(){function t(e){var n,r,i,o,s=e.preLoad,u=e.error,l=e.throttleWait,d=e.preLoadTop,f=e.dispatchEvent,v=e.loading,g=e.attempt,y=e.silent,m=void 0===y||y,b=e.scale,w=e.listenEvents,_=e.filter,E=e.adapter,T=e.observer,z=e.observerOptions;a(this,t),this.version="__VUE_LAZYLOAD_NEXT_VERSION__",this.lazyContainerMananger=null,this.mode=c,this.ListenerQueue=[],this.TargetIndex=0,this.TargetQueue=[],this.options={silent:m,dispatchEvent:!!f,throttleWait:l||200,preLoad:s||1.3,preLoadTop:d||0,error:u||k,loading:v||k,attempt:g||3,scale:b||p(b),listenEvents:w||Q,supportWebp:A(),filter:_||{},adapter:E||{},observer:!!T,observerOptions:z||I},this._initEvent(),this._imageCache=new L(200),this.lazyLoadHandler=(n=this._lazyLoadHandler.bind(this),r=this.options.throttleWait,i=null,o=0,function(){if(!i){var e=Date.now()-o,t=this,a=arguments,s=function(){o=Date.now(),i=!1,n.apply(t,a)};e>=r?s():i=setTimeout(s,r)}}),this.setMode(this.options.observer?h:c)}return s(t,[{key:"config",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this.options,e)}},{key:"performance",value:function(){var e=[];return this.ListenerQueue.map((function(t){return e.push(t.performance())})),e}},{key:"addLazyBox",value:function(e){this.ListenerQueue.push(e),l&&(this._addListenerTarget(window),this._observer&&this._observer.observe(e.el),e.$el&&e.$el.parentNode&&this._addListenerTarget(e.$el.parentNode))}},{key:"add",value:function(t,n,r){var i=this;if(this.ListenerQueue.some((function(e){return e.el===t})))return this.update(t,n),e.nextTick(this.lazyLoadHandler);var o=this._valueFormatter(n.value),a=o.src,s=o.loading,u=o.error,d=o.cors;e.nextTick((function(){a=v(t,i.options.scale)||a,i._observer&&i._observer.observe(t);var r=Object.keys(n.modifiers)[0],o=void 0;r&&(o=(o=n.instance.$refs[r])?o.el||o:document.getElementById(r)),o||(o=function(e){if(l){if(!(e instanceof Element))return window;for(var t=e;t&&t!==document.body&&t!==document.documentElement&&t.parentNode;){if(/(scroll|auto)/.test(w(t)))return t;t=t.parentNode}return window}}(t));var c=new E(t,a,u,s,n.arg,o,i.options,d,i._elRenderer.bind(i),i._imageCache);i.ListenerQueue.push(c),l&&(i._addListenerTarget(window),i._addListenerTarget(o)),e.nextTick((function(){return i.lazyLoadHandler()}))}))}},{key:"update",value:function(t,n,r){var i=this,o=this._valueFormatter(n.value),a=o.src,s=o.loading,u=o.error;a=v(t,this.options.scale)||a;var l=this.ListenerQueue.find((function(e){return e.el===t}));l?l.update({src:a,loading:s,error:u}):this.add(t,n,r),this._observer&&(this._observer.unobserve(t),this._observer.observe(t)),e.nextTick((function(){return i.lazyLoadHandler()}))}},{key:"remove",value:function(e){if(e){this._observer&&this._observer.unobserve(e);var t=this.ListenerQueue.find((function(t){return t.el===e}));t&&(this._removeListenerTarget(t.$parent),this._removeListenerTarget(window),f(this.ListenerQueue,t),t.$destroy&&t.$destroy())}}},{key:"removeComponent",value:function(e){e&&(f(this.ListenerQueue,e),this._observer&&this._observer.unobserve(e.el),e.$parent&&e.$el.parentNode&&this._removeListenerTarget(e.$el.parentNode),this._removeListenerTarget(window))}},{key:"setMode",value:function(e){var t=this;d||e!==h||(e=c),this.mode=e,e===c?(this._observer&&(this.ListenerQueue.forEach((function(e){t._observer.unobserve(e.el)})),this._observer=null),this.TargetQueue.forEach((function(e){t._initListen(e.el,!0)}))):(this.TargetQueue.forEach((function(e){t._initListen(e.el,!1)})),this._initIntersectionObserver())}},{key:"_addListenerTarget",value:function(e){if(e){var t=this.TargetQueue.find((function(t){return t.el===e}));return t?t.childrenCount++:(t={el:e,id:++this.TargetIndex,childrenCount:1,listened:!0},this.mode===c&&this._initListen(t.el,!0),this.TargetQueue.push(t)),this.TargetIndex}}},{key:"_removeListenerTarget",value:function(e){var t=this;this.TargetQueue.forEach((function(n,r){n.el===e&&(n.childrenCount--,n.childrenCount||(t._initListen(n.el,!1),t.TargetQueue.splice(r,1),n=null))}))}},{key:"_initListen",value:function(e,t){var n=this;this.options.listenEvents.forEach((function(r){return y[t?"on":"off"](e,r,n.lazyLoadHandler)}))}},{key:"_initEvent",value:function(){var e=this;this.Event={listeners:{loading:[],loaded:[],error:[]}},this.$on=function(t,n){e.Event.listeners[t]||(e.Event.listeners[t]=[]),e.Event.listeners[t].push(n)},this.$once=function(t,n){var r=e;e.$on(t,(function e(){r.$off(t,e),n.apply(r,arguments)}))},this.$off=function(t,n){if(n)f(e.Event.listeners[t],n);else{if(!e.Event.listeners[t])return;e.Event.listeners[t].length=0}},this.$emit=function(t,n,r){e.Event.listeners[t]&&e.Event.listeners[t].forEach((function(e){return e(n,r)}))}}},{key:"_lazyLoadHandler",value:function(){var e=this,t=[];this.ListenerQueue.forEach((function(e,n){e.el&&e.el.parentNode&&!e.state.loaded||t.push(e),e.checkInView()&&(e.state.loaded||e.load())})),t.forEach((function(t){f(e.ListenerQueue,t),t.$destroy&&t.$destroy()}))}},{key:"_initIntersectionObserver",value:function(){var e=this;d&&(this._observer=new IntersectionObserver(this._observerHandler.bind(this),this.options.observerOptions),this.ListenerQueue.length&&this.ListenerQueue.forEach((function(t){e._observer.observe(t.el)})))}},{key:"_observerHandler",value:function(e){var t=this;e.forEach((function(e){e.isIntersecting&&t.ListenerQueue.forEach((function(n){if(n.el===e.target){if(n.state.loaded)return t._observer.unobserve(n.el);n.load()}}))}))}},{key:"_elRenderer",value:function(e,t,n){if(e.el){var r=e.el,i=e.bindType,o=void 0;switch(t){case"loading":o=e.loading;break;case"error":o=e.error;break;default:o=e.src}if(i?r.style[i]='url("'+o+'")':r.getAttribute("src")!==o&&r.setAttribute("src",o),r.setAttribute("lazy",t),this.$emit(t,e,n),this.options.adapter[t]&&this.options.adapter[t](e,this.options),this.options.dispatchEvent){var a=new CustomEvent(t,{detail:e});r.dispatchEvent(a)}}}},{key:"_valueFormatter",value:function(e){var t,n=e,r=this.options.loading,i=this.options.error,a=this.options.cors;return null!==(t=e)&&"object"===(void 0===t?"undefined":o(t))&&(e.src||this.options.silent||console.error("Vue Lazyload Next warning: miss src with "+e),n=e.src,r=e.loading||this.options.loading,i=e.error||this.options.error),{src:n,loading:r,error:i,cors:a}}}]),t}(),z=function(t,n){var r=e.reactive({});return{rect:r,checkInView:function(){return r=t.value.getBoundingClientRect(),l&&r.top<window.innerHeight*n&&r.bottom>0&&r.left<window.innerWidth*n&&r.right>0}}},x=function(t){return e.defineComponent({props:{tag:{type:String,default:"div"}},emits:["show"],setup:function(n,r){var i=r.emit,o=r.slots,a=e.ref(null),s=e.reactive({loaded:!1,error:!1,attempt:0}),u=e.ref(!1),l=z(a,t.options.preLoad),d=l.rect,c=l.checkInView,h=function(){u.value=!0,s.loaded=!0,i("show",u.value)},f=e.computed((function(){return{el:a.value,rect:d,checkInView:c,load:h,state:s}}));return e.onMounted((function(){t.addLazyBox(f.value),t.lazyLoadHandler()})),e.onUnmounted((function(){t.removeComponent(f.value)})),function(){var t;return e.createVNode(n.tag,{ref:a},[u.value&&(null===(t=o.default)||void 0===t?void 0:t.call(o))])}}})},O=function(){function e(t){a(this,e),this.lazy=t,t.lazyContainerMananger=this,this._queue=[]}return s(e,[{key:"bind",value:function(e,t,n){var r=new R(e,t,n,this.lazy);this._queue.push(r)}},{key:"update",value:function(e,t,n){var r=this._queue.find((function(t){return t.el===e}));r&&r.update(e,t)}},{key:"unbind",value:function(e,t,n){var r=this._queue.find((function(t){return t.el===e}));r&&(r.clear(),f(this._queue,r))}}]),e}(),S={selector:"img",error:"",loading:""},R=function(){function e(t,n,r,i){a(this,e),this.el=t,this.vnode=r,this.binding=n,this.options={},this.lazy=i,this._queue=[],this.update(t,n)}return s(e,[{key:"update",value:function(e,t){var n=this;this.el=e,this.options=u({},S,t.value),this.getImgs().forEach((function(e){n.lazy.add(e,u({},n.binding,{value:{src:e.getAttribute("data-src")||e.dataset.src,error:e.getAttribute("data-error")||e.dataset.error||n.options.error,loading:e.getAttribute("data-loading")||e.dataset.loading||n.options.loading}}),n.vnode)}))}},{key:"getImgs",value:function(){return Array.from(this.el.querySelectorAll(this.options.selector))}},{key:"clear",value:function(){var e=this;this.getImgs().forEach((function(t){return e.lazy.remove(t)})),this.vnode=null,this.binding=null,this.lazy=null}}]),e}(),B=function(t){return e.defineComponent({props:{src:[String,Object],tag:{type:String,default:"img"}},setup:function(n,r){var i=r.slots,o=e.ref(null),a=e.reactive({src:"",error:"",loading:"",attempt:t.options.attempt}),s=e.reactive({loaded:!1,error:!1,attempt:0}),u=z(o,t.options.preLoad),l=u.rect,d=u.checkInView,c=e.ref(""),h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_;if(s.attempt>a.attempt-1&&s.error)return t.options.silent||console.log("VueLazyload log: "+a.src+" tried too more than "+a.attempt+" times"),void e();var n=a.src;m({src:n},(function(e){var t=e.src;c.value=t,s.loaded=!0}),(function(){s.attempt++,c.value=a.error,s.error=!0}))},f=e.computed((function(){return{el:o.value,rect:l,checkInView:d,load:h,state:s}}));e.onMounted((function(){t.addLazyBox(f.value),t.lazyLoadHandler()})),e.onUnmounted((function(){t.removeComponent(f.value)}));var v=function(){var e=t._valueFormatter(n.src),r=e.src,i=e.loading,o=e.error;s.loaded=!1,a.src=r,a.error=o,a.loading=i,c.value=a.loading};return e.watch((function(){return n.src}),(function(){v(),t.addLazyBox(f.value),t.lazyLoadHandler()})),v(),function(){var t;return e.createVNode(n.tag,{src:c.value,ref:o},[null===(t=i.default)||void 0===t?void 0:t.call(i)])}}})};return{install:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new T(t),r=new O(n),i=Number(e.version.split(".")[0]);if(i<3)return new Error("Vue version at least 3.0");e.config.globalProperties.$Lazyload=n,t.lazyComponent&&e.component("lazy-component",x(n)),t.lazyImage&&e.component("lazy-image",B(n)),e.directive("lazy",{beforeMount:n.add.bind(n),beforeUpdate:n.update.bind(n),updated:n.lazyLoadHandler.bind(n),unmounted:n.remove.bind(n)}),e.directive("lazy-container",{beforeMount:r.bind.bind(r),updated:r.update.bind(r),unmounted:r.unbind.bind(r)})}}}));
